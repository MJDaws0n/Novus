module test_arrays;

fn len(s: str) -> i32 {
    let count: i32 = 0;
    let i: i32 = 0;
    while (s[i] != '\0') {
        count = count + 1;
        i = i + 1;
    }
    return count;
}

fn array_len(arr: []i32) -> i32 {
    mov(x9, arr);
    let ptr: u64 = getreg(x9);
    return load32(ptr + 8);
}

fn print(msg: str) -> void {
    msg = msg + "\n";
    mov(x0, 1);
    mov(x1, msg);
    mov(x2, len(msg));
    mov(x16, 0x2000004);
    syscall();
}

fn itoa(n: i32) -> str {
    let out: str = "";
    if (n == 0) { return "0"; }
    let neg: i32 = 0;
    if (n < 0) { neg = 1; n = 0 - n; }
    let digits: str = "";
    while (n > 0) {
        let digit: i32 = n % 10;
        if (digit == 0) { digits = digits + "0"; }
        else if (digit == 1) { digits = digits + "1"; }
        else if (digit == 2) { digits = digits + "2"; }
        else if (digit == 3) { digits = digits + "3"; }
        else if (digit == 4) { digits = digits + "4"; }
        else if (digit == 5) { digits = digits + "5"; }
        else if (digit == 6) { digits = digits + "6"; }
        else if (digit == 7) { digits = digits + "7"; }
        else if (digit == 8) { digits = digits + "8"; }
        else if (digit == 9) { digits = digits + "9"; }
        n = n / 10;
    }
    if (neg == 1) { digits = digits + "-"; }
    let i: i32 = len(digits) - 1;
    while (i >= 0) {
        out = out + digits[i];
        i = i - 1;
    }
    return out;
}

fn exit(code: i32) -> void {
    mov(x0, code);
    mov(x16, 0x2000001);
    syscall();
}

fn main() -> i32 {
    print("Start");

    let nums: []i32 = [10, 20, 30];
    print("Array created");
    print("Length: " + itoa(array_len(nums)));

    array_append(nums, 40);
    print("After append: " + itoa(array_len(nums)));

    let popped: i32 = array_pop(nums);
    print("Popped: " + itoa(popped));

    print("Done");
    exit(0);
    return 0;
}
